<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aoife and Andrew's Wedding</title>
</head>
<body>
  <h1>Aoife and Andrew's Wedding</h1>
  <p>‚ÄúTo me, you are perfect.‚Äù</p>

  <div>
    <h2>Share your favorite moments from our special day! üì∏</h2>
    <div>
      <span>üì∑</span>
      <p>Drop your photos here</p>
      <p>or click to browse your device</p>
      <p>Up to 30 photos or videos ‚Ä¢ JPEG, PNG, HEIC, MP4 ‚Ä¢ Max 1GB each</p>
      <input type="file" id="fileInput" multiple accept="image/jpeg,image/png,image/heic,video/mp4" />
    </div>
    <div>
      <button onclick="uploadFiles()">Upload Photos ‚ú®</button>
    </div>
  </div>

  <div>
    <p>If you‚Äôre having trouble uploading or prefer to email them instead, please send your snaps to: <br> <a href="mailto:andrewandaoifegethitched@gmail.com">andrewandaoifegethitched@gmail.com</a></p>
  </div>

  <div>
    <p>Not ready to upload right now?</p>
    <p>You can bookmark this page and come back anytime‚Äîwhether itÔøΩÔøΩs later tonight or next week.</p>
    <p>Save this link for later: <br> <a href="https://aoifeandandrew.github.io/AA-Wedding-Uploads/">https://aoifeandandrew.github.io/AA-Wedding-Uploads/</a></p>
  </div>

  <footer>
    <p>You helped make our day unforgettable.</p>
    <p>Now let‚Äôs make it beautifully shareable.</p>
  </footer>

  <script>
    async function uploadFiles() {
      const fileInput = document.getElementById('fileInput');
      const files = fileInput.files;

      if (files.length === 0) {
        alert('Please select at least one file.');
        return;
      }
      if (files.length > 30) {
        alert('You can upload up to 30 files at a time.');
        return;
      }

      for (const file of files) {
        if (file.size > 1_000_000_000) {
          alert(`File ${file.name} exceeds the 1GB limit.`);
          continue;
        }

        try {
          // Request presigned URL from Worker
          const response = await fetch('https://worker.andrewandaoifegethitched.workers.dev', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ filename: file.name })
          });
          const { url } = await response.json();

          if (!url) {
            alert(`Failed to get upload URL for ${file.name}`);
            continue;
          }

          // Upload file directly to R2 using presigned URL
          const uploadResponse = await fetch(url, {
            method: 'PUT',
            body: file
          });
          if (uploadResponse.ok) {
            console.log(`Successfully uploaded ${file.name}`);
          } else {
            alert(`Failed to upload ${file.name}`);
          }
        } catch (err) {
          alert(`Error uploading ${file.name}: ${err.message}`);
        }
      }
      alert('Upload complete!');
    }
  </script>
</body>
</html>
